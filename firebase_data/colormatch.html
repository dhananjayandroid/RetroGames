<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { margin: 0; padding: 0; background: #111; color: #fff; font-family: monospace; overflow: hidden; touch-action: none; }
  canvas { display: block; width: 100%; height: 100%; }
  #score { position: absolute; top: 10px; left: 10px; font-size: 24px; color: #0ff; text-shadow: 0 0 5px #0ff; }
  #msg { position: absolute; top: 50%; width: 100%; text-align: center; font-size: 24px; display: none; }
</style>
</head>
<body>
<div id="score">0</div>
<div id="msg">TAP TO START</div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();
let playing = false; let score = 0; let targetColor = ''; let options = []; let timer = 0; let lastTime = 0;
const COLORS = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6'];
function startGame() {
  playing = true; score = 0; nextRound();
  document.getElementById('msg').style.display = 'none';
  loop(0);
}
function nextRound() {
  targetColor = COLORS[Math.floor(Math.random() * COLORS.length)];
  options = [...COLORS].sort(() => Math.random() - 0.5).slice(0, 4);
  if (!options.includes(targetColor)) options[0] = targetColor;
  options.sort(() => Math.random() - 0.5);
  timer = 3000;
}
window.addEventListener('touchstart', handleInput);
window.addEventListener('mousedown', handleInput);
function handleInput(e) {
  if (!playing) { startGame(); return; }
  const x = (e.touches ? e.touches[0].clientX : e.clientX);
  const y = (e.touches ? e.touches[0].clientY : e.clientY);
  const btnW = canvas.width / 2; const btnH = 100;
  const startY = canvas.height - 250;
  options.forEach((col, i) => {
    const bx = (i % 2) * btnW; const by = startY + Math.floor(i / 2) * btnH;
    if (x > bx && x < bx + btnW && y > by && y < by + btnH) {
      if (col === targetColor) { score += 10; nextRound(); }
      else gameOver();
    }
  });
}
function update(dt) {
  timer -= dt; if (timer <= 0) gameOver();
  document.getElementById('score').innerText = Math.floor(score);
}
function draw() {
  ctx.fillStyle = '#111'; ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = targetColor; ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/3, 80, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.font = '20px monospace'; ctx.fillText('MATCH THIS', canvas.width/2, canvas.height/3 - 100);
  const btnW = canvas.width / 2; const btnH = 100; const startY = canvas.height - 250;
  options.forEach((col, i) => {
    ctx.fillStyle = col; ctx.fillRect((i % 2) * btnW + 5, startY + Math.floor(i / 2) * btnH + 5, btnW - 10, btnH - 10);
  });
  ctx.fillStyle = '#0f0'; ctx.fillRect(0, 0, (timer / 3000) * canvas.width, 5);
}
function gameOver() {
  playing = false;
  if (window.Android) window.Android.gameOver(Math.floor(score));
  else { document.getElementById('msg').style.display = 'block'; document.getElementById('msg').innerText = "GAME OVER"; }
}
window.revive = function() { playing = true; nextRound(); loop(0); };
function loop(t) {
  if (!playing) return; const dt = t - lastTime; lastTime = t; update(dt || 16); draw(); requestAnimationFrame(loop);
}
document.getElementById('msg').style.display = 'block';
</script>
</body>
</html>
